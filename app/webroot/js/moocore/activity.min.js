(function(a,d){"function"===typeof define&&define.amd?define("jquery mooPhrase mooBehavior mooMention mooEmoji mooFileUploader mooUser mooButton mooGlobal mooResponsive mooAttach mooComment mooLike mooTooltip autogrow spinner".split(" "),d):"object"===typeof exports?module.exports=d(require("jquery")):a.mooActivities=d()})(this,function(a,d,u,l,G,v,H,w,x,I,J,g,K,p){var M=function(){a(".removeTags").unbind("click");a(".removeTags").click(function(){var b=a(this).data();L(b.activityId,b.activityItemType)})},
L=function(b,c){a.fn.SimpleModal({btn_ok:d.__("confirm"),btn_cancel:d.__("cancel"),callback:function(){a.post(mooConfig.url.base+"/activities/ajax_remove_tags",{item_id:b,item_type:c},function(){window.location.reload()})},title:d.__("remove_tags"),contents:d.__("remove_tags_contents"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()},N=function(){a(".showAllComments").unbind("click");a(".showAllComments").on("click",function(){var b=a(this).data().id;a("#comments_"+b+" .hidden").fadeIn();
a("#comments_"+b+" .hidden").attr("class","");a("#all_comments_"+b).hide()})},O=function(b){a.fn.SimpleModal({btn_ok:d.__("ok"),btn_cancel:d.__("cancel"),callback:function(){a.post(mooConfig.url.base+"/activities/ajax_remove",{id:b},function(){a("#activity_"+b).fadeOut("normal",function(){a("#activity_"+b).remove()})})},title:d.__("please_confirm"),contents:d.__("please_confirm_remove_this_activity"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()},Q=function(){a(".editActivity").unbind("click");
a(".editActivity").click(function(){var b=a(this).data();P(b.activityId)})},R=function(){a(".removeActivity").unbind("click");a(".removeActivity").click(function(){var b=a(this).data();O(b.activityId)})},q=[],P=function(b){0==a("#activity_edit_"+b).length&&a.post(mooConfig.url.base+"/activities/ajax_loadActivityEdit/"+b,function(c){a("#activity_feed_content_text_"+b+" .comment_message").hide();a(c).insertAfter(a("#activity_feed_content_text_"+b+" .comment_message"));q.push(b);r();l.init(a(c).find("textarea").attr("id"),
"edit_activity");G.init(a(c).find("textarea").attr("id"))})},y=function(b){a("#message_edit_"+b).siblings(".textoverlay")&&a("#message_edit_"+b).destroyOverlayInstance(a("#message_edit_"+b));a("#activity_feed_content_text_"+b+" .comment_message").show();a("#activity_edit_"+b).remove();b=a.inArray(b,q);q.splice(b,1)},S=function(b){if(""!=a.trim(a("#message_edit_"+b).val())){var c=0!=a("#message_edit_"+b+"_hidden").length?a("#message_edit_"+b+"_hidden").val():a("#message_edit_"+b).val();a.post(mooConfig.url.base+
"/activities/ajax_editActivity/"+b,{message:c},function(c){a("#message_edit_"+b).siblings(".textoverlay")&&a("#message_edit_"+b).destroyOverlayInstance(a("#message_edit_"+b));a("#activity_feed_content_text_"+b+" .comment_message").html(a(c).html());a("#history_activity_"+b).show();y(b)})}},T=function(b){a.fn.SimpleModal({btn_ok:d.__("ok"),btn_cancel:d.__("cancel"),callback:function(){a.post(mooConfig.url.base+"/comments/ajax_remove",{id:b},function(){a("#photo_comment_"+b).fadeOut("normal",function(){a("#photo_comment_"+
b).remove()})})},title:d.__("please_confirm"),contents:d.__("please_confirm_remove_this_activity"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()},U=function(b){if(""!=a.trim(a("#commentForm_"+b).val())||""!=a("#comment_image_"+b).val()){a("#commentButton_"+b+" a").addClass("disabled");a("#commentButton_"+b+" a").prepend('<i class="icon-refresh icon-spin"></i>');var c=0<a("#commentForm_"+b).siblings("input.messageHidden").length?a("#commentForm_"+b).siblings("input.messageHidden").val():
a("#commentForm_"+b).val();a.post(mooConfig.url.base+"/activities/ajax_comment",{activity_id:b,thumbnail:a("#comment_image_"+b).val(),comment:c},function(c){""!=c&&(z(b,c),c=a("#commentForm_"+b),l.resetMention(c),p.init())})}},V=function(b,c,e){if(""!=a.trim(a("#commentForm_"+e).val())||""!=a("#comment_image_"+e).val()){a("#commentButton_"+e+" a").prepend('<i class="icon-refresh icon-spin"></i>');a("#commentButton_"+e+" a").addClass("disabled");var A="",A=0<a("#commentForm_"+e).siblings(".messageHidden").length?
a("#commentForm_"+e).siblings(".messageHidden").val():a("#commentForm_"+e).val();a.post(mooConfig.url.base+"/comments/ajax_share",{type:b,target_id:c,thumbnail:a("#comment_image_"+e).val(),message:A,activity:1},function(b){""!=b&&(z(e,b),b=a("#commentForm_"+e),l.resetMention(b),p.init())})}},z=function(b,c){"1"===mooConfig.comment_sort_style?a("#newComment_"+b).before(c):a("#newComment_"+b).after(c);a(".slide").slideDown();a("#commentButton_"+b+" a").removeClass("disabled");a("#commentButton_"+b+
" a i").remove();a("#commentForm_"+b).val("");a("#commentButton_"+b).hide();a(".commentBox").css("height","27px");a("#comment_preview_image_"+b).html("");a("#comment_image_"+b).val("");a("#comment_button_attach_"+b).show();u.registerImageComment();r()},W=function(b,c,e){a.post(mooConfig.url.base+"/activities/ajax_changeActivityPrivacy/",{activityId:c,privacy:e},function(a){if(""!=a){a=JSON.parse(a);var e=b.parents(".dropdown");e.find("a#permission_"+c).attr("original-title",a.text);e.find("a#permission_"+
c+" i").html(a.icon);e.find(".dropdown-menu li a").removeClass("n52");b.addClass("n52")}})},r=function(b){a("textarea:not(.no-grow)").autogrow();M();Q();R();g.initEditActivityComment();g.initRemoveActivityComment();g.initRemoveItemComment();a("body").off("click.activity","a.admin-or-owner-confirm-delete-photo-comment").on("click.activity","a.admin-or-owner-confirm-delete-photo-comment",function(){var b=a(this).data();T(b.commentId)});a("body").off("click.activity","a.viewer-submit-comment").on("click.activity",
"a.viewer-submit-comment",function(){var b=a(this).data();U(b.activityId)});a("body").off("click.activity","a.viewer-submit-item-comment").on("click.activity","a.viewer-submit-item-comment",function(){var b=a(this).data();V(b.itemType,b.activityItemId,b.activityId)});a("body").off("click.activity","a.change-activity-privacy").on("click.activity","a.change-activity-privacy",function(){var b=a(this).data();W(a(this),b.activityId,b.privacy)});g.initShowCommentForm();K.initLikeActivity();g.initRemoveItemComment();
g.initEditItemComment();g.initShowCommentBtn();N();u.initMoreResults()},C=function(b){var c=a("#message").val();b=(result=b.match(/\b([\d\w\.\/\+\-\?\:]*)((ht|f)tp(s|)\:\/\/|[\d\d\d|\d\d]\.[\d\d\d|\d\d]\.|www\.|\.tv|\.ac|\.com|\.edu|\.gov|\.int|\.mil|\.net|\.org|\.biz|\.info|\.name|\.pro|\.museum|\.co)([\d\w\.\/\%\+\-\=\&amp;\?\:\\\&quot;\'\,\|\~\;]*)\b/gi))?result[0]:void 0;if(!m.hasOwnProperty(b)&&b&&("http://"==t(b,0,7)||"https://"==t(b,0,8)||"www."==t(b,0,4))){var e=h(b,"https://",0),d=h(b,"http://",
0);if(0===e||0===d){var e=h(b,"youtube.com",0),d=h(b,"youtu.be",0),f=h(b,"vimeo.com",0);e||d||f?(a(".userTagging-userShareVideo").removeClass("hidden"),a(".userTagging-userShareLink").addClass("hidden"),a("#userShareLink").val(""),a("#userShareVideo").val(b),B("userShareVideo",b,!0,c)):(a(".userTagging-userShareLink").removeClass("hidden"),a(".userTagging-userShareVideo").addClass("hidden"),a("#userShareVideo").val(""),a("#userShareLink").val(b),B("userShareLink",b,!0,c))}}},t=function(a,c,e){0>c&&
(c+=a.length);e=void 0==e?a.length:0>e?e+a.length:e+c;e<c&&(e=c);return a.substring(c,e)},h=function(a,c,e){a=(a+"").indexOf(c,e||0);return-1===a?!1:a},X=function(){a(".removeImage").unbind("click");a(".removeImage").on("click",function(){a(this).parent().remove();a("#shareImage").val("0")});a(".removeContent").unbind("click");a(".removeContent").on("click",function(){D()})},D=function(){""!=a("#userShareLink").val().trim()&&(m[a("#userShareLink").val().trim()]="1");""!=a("#userShareVideo").val().trim()&&
(m[a("#userShareVideo").val().trim()]="1");a("#preview_link").remove();a("#userShareLink").val("");a("#userShareVideo").val("");a("#shareImage").val("1")},n=!1,k={},m={},B=function(b,c,e,d){var f=a(".userTagging-"+b);k.hasOwnProperty(c)||f.spin("tiny");setTimeout(function(){n||(k.hasOwnProperty(c)?(console.log(k[c]),n=!0,E(f,c,e,d,k[c])):(n=!0,a.post(mooConfig.url.base+"/activities/ajax_preview_link",{content:c},function(a){k[c]=a;f.spin(!1);E(f,c,e,d,a)})))},0)},E=function(b,c,e,d,f){a("#preview_link").remove();
c=jQuery.parseJSON(f);jQuery.isEmptyObject(c)||"undefined"===typeof c.title||"404 Not Found"===c.title||"403 Forbidden"===c.title||(f='<div class="activity_item" id="preview_link">',"undefined"!==typeof c.image&&""!=c.image&&(f+='<div class="activity_left"><a class="removePreviewlink removeImage" href="javascript:void(0)"><i class="icon-delete material-icons">clear</i></a>',f=-1!=c.image.indexOf("http")?f+('<img src="'+c.image+'" class="img_wrapper2">'):f+('<img src="'+mooConfig.url.base+"/uploads/links/"+
c.image+'" class="img_wrapper2">'),f+='<input type="hidden" name="data[share_image]" id="userShareLink" value="1"></div>'),f=""!=c.image?f+'<div class="activity_right">':f+"<div>",f=f+'<a class="removePreviewlink removeContent" href="javascript:void(0)"><i class="icon-delete material-icons">clear</i></a>'+('<a class="attachment_edit_link feed_title" href="'+c.url+'" target="_blank" rel="nofollow">'),f+="<strong>"+c.title+"</strong>",f+="</a>","undefined"!==typeof c.description&&""!=c.description&&
(f=f+'<div class="attachment_body_description">'+('<a class="attachment_edit_link comment_message feed_detail_text">'+c.description+"</a>"),f+="</div>"),b.append(f+'<input type="hidden" name="data[share_text]" id="userShareLink" value="1"></div></div>'),e&&(a(".textoverlay").text(d),a(".autogrow-textarea-mirror").text(d)),X());n=!1},F=function(){a("#video_pc_feed_preview").hide();a("#title").val("");a("#description").val("");a("#video_destination").val("")},Y=function(){if(!H.validateUser())return!1;
var b=a("#message").val();""!=a.trim(b)||""!=a("#userShareLink").val()||""!=a("#userShareVideo").val()||""!=a("#wall_photo_preview :not(#addMoreImage)").html()&&"add"!=a("#wall_photo_preview :not(#addMoreImage)").html()?(w.disableButton("status_btn"),a("#status_btn").spin("small"),a.post(mooConfig.url.base+"/activities/ajax_share",a("#wallForm").serialize(),function(b){a("#wall_photo").val("");w.enableButton("status_btn");a("#message").val("");a(".userTagging-userShareLink").addClass("hidden");a(".userTagging-userShareVideo").addClass("hidden");
a("#shareImage").val("1");0<a("#video_destination").length&&""!=a("#video_destination").val()?(a.fn.SimpleModal({btn_ok:d.__("btn_ok"),btn_cancel:d.__("cancel"),model:"modal",title:d.__("processing_video"),contents:d.__("processing_video_msg")}).showModal(),setTimeout(function(){a("#simpleModal").hide();a(".modal-backdrop").remove()},3E3),F(),b=a.parseJSON(b),a.post(mooConfig.url.base+"/upload_video/upload_videos/feed_convert",{activity_id:b.activity_id},function(a){})):""!=b&&(0<a(".no-feed").length&&
a("#list-content .no-feed").remove(),a("#list-content").prepend(b),a("#message").css("height","36px"),a(".slide").slideDown(),a("#wall_photo_preview span:not(.addMoreImage)").remove(),a("#addMoreImage").hide(),a(".form-feed-holder").css("padding-bottom","0px"),b=a(b).find("div[id^=comment_button_attach_]").data("id"),J.registerAttachComment(b));a("#status_btn").spin(!1);I.init();a(".tip").tipsy({html:!0,gravity:"s"});a('[data-toggle="tooltip"]').tooltip();b=a("#wallForm").find("#message");l.resetMention(b);
p.init();a("#preview_link").remove();m={};a("#userShareLink").val("")}),a(".stt-action .userTagging-userTagging").addClass("hidden"),a(".stt-action").css("margin-top","0"),a("#wall_photo_preview").hide(),a("#userTagging").tagsinput("removeAll")):a.fn.SimpleModal({btn_ok:d.__("btn_ok"),btn_cancel:d.__("cancel"),model:"modal",title:d.__("warning"),contents:d.__("share_whats_new_can_not_empty")}).showModal()};return{init:r,initActivityForm:function(){a('[data-toggle="tooltip"]').tooltip();new v.fineUploader({element:a("#select-2")[0],
text:{uploadButton:'<div class="upload-section"><i class="material-icons">photo_camera</i></div>'},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},multiple:!0,request:{endpoint:mooConfig.url.base+"/upload/wall"},callbacks:{onError:x.errorHandler,onSubmit:function(b,e){a('<span id="feed_'+b+'" style="background-image:url('+mooConfig.url.base+'/img/indicator.gif);background-size:inherit;background-repeat:no-repeat"></span>').insertBefore(".addMoreImage");a("#wall_photo_preview").show();
a("#addMoreImage").show();F()},onComplete:function(b,e,d,f){d.success&&(a('[data-toggle="tooltip"]').tooltip("hide"),a(this.getItemByFileId(b)).remove(),a('<img src="'+d.file_path+'">').load(function(){var c=a("#feed_"+b);c.attr("style","background-image:url("+d.file_path+")");var e=a('<a href="#"><i class="material-icons thumb-review-delete">clear</i></a>');c.append(e);c.find(".thumb-review-delete").unbind("click");c.find(".thumb-review-delete").click(function(b){b.preventDefault();a(this).parents("span").remove();
a("#wall_photo").val(a("#wall_photo").val().replace(d.photo+",",""))})}),e=a("#wall_photo").val(),a("#wall_photo").val(e+d.photo+","),D())}}});if(0<a("#videoPcFeed").length){var b=new v.fineUploader({element:a("#videoPcFeed")[0],multiple:!1,text:{uploadButton:'<div class="upload-section"><i class="material-icons">videocam</i></div>'},validation:{allowedExtensions:mooConfig.videoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/upload_video/upload_videos/process_upload"},callbacks:{onError:x.errorHandler,
onSubmit:function(b,e){a("#wall_photo_preview").hide();a("#video_pc_feed_preview").show();a(".video_thumb").spin("medium")},onComplete:function(b,e,d){d.success&&(a("#video_destination").val(d.filename),a(".video_thumb").spin(!1))}}});a("#triggerUpload").click(function(){b._storedFileIds.length?(b.uploadStoredFiles(),a(".error-message").hide()):(a(".error-message").html(d.__("uv_4")),a(".error-message").show())})}a("#addMoreImage").unbind("click");a("#addMoreImage").click(function(){a("#select-2 input[name=file]").click()});
a("#message").on("focus",function(){g.showCommentButton(0)});a("#status_btn").unbind("click");a("#status_btn").click(function(){Y()});a("#status_box").slideDown("slow");a("#message").on("paste",function(b){""==a("#wall_photo").val().trim()&&0==a("#preview_link").length&&b.originalEvent.clipboardData&&(b=b.originalEvent.clipboardData.getData("text/plain"),C(b))});a("#message").on("keydown keyup keypress",function(b){""!=a("#wall_photo").val().trim()||b.ctrlKey||0!=a("#preview_link").length||(b=a(this).val(),
C(b))})},initOnAjaxLoadActivityEdit:function(){a(".cancelEditActivity").unbind("click");a(".cancelEditActivity").click(function(){var b=a(this).data();y(b.activityId)});a(".confirmEditActivity").unbind("click");a(".confirmEditActivity").click(function(){var b=a(this).data();S(b.activityId)})}}});